<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="">
  <meta name="author" content="Mark Otto, Jacob Thornton, and Bootstrap contributors">
  <meta name="generator" content="Hugo 0.88.1">
  <link rel="canonical" href="https://getbootstrap.com/docs/5.1/examples/starter-template/">
  <meta charset="UTF-8">
  <!-- Bootstrap core CSS -->
  <title>Inicio App Monolitic</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p"
    crossorigin="anonymous"></script>
  <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css">
  <style>
    .bd-placeholder-img {
      font-size: 1.125rem;
      text-anchor: middle;
      -webkit-user-select: none;
      -moz-user-select: none;
      user-select: none;
    }

    @media (min-width: 768px) {
      .bd-placeholder-img-lg {
        font-size: 3.5rem;
      }
    }

    .errorMessage {
      color: green;
    }
  </style>


  <!-- Custom styles for this template -->
  <link href="starter-template.css" rel="stylesheet">
</head>


<body>

  <div class="col-lg-10 mx-auto p-1   py-md-4">

    <div class="">
      <header class="d-flex align-items-center pb-2 mb-0 border-bottom">
        <a href="/" class="d-flex align-items-center text-dark text-decoration-none">
          <svg xmlns="http://www.w3.org/2000/svg" width="40" height="32" class="me-2" viewBox="0 0 118 94" role="img">
            <title>Inicio App Monolitic</title>
            <path fill-rule="evenodd" clip-rule="evenodd"
              d="M24.509 0c-6.733 0-11.715 5.893-11.492 12.284.214 6.14-.064 14.092-2.066 20.577C8.943 39.365 5.547 43.485 0 44.014v5.972c5.547.529 8.943 4.649 10.951 11.153 2.002 6.485 2.28 14.437 2.066 20.577C12.794 88.106 17.776 94 24.51 94H93.5c6.733 0 11.714-5.893 11.491-12.284-.214-6.14.064-14.092 2.066-20.577 2.009-6.504 5.396-10.624 10.943-11.153v-5.972c-5.547-.529-8.934-4.649-10.943-11.153-2.002-6.484-2.28-14.437-2.066-20.577C105.214 5.894 100.233 0 93.5 0H24.508zM80 57.863C80 66.663 73.436 72 62.543 72H44a2 2 0 01-2-2V24a2 2 0 012-2h18.437c9.083 0 15.044 4.92 15.044 12.474 0 5.302-4.01 10.049-9.119 10.88v.277C75.317 46.394 80 51.21 80 57.863zM60.521 28.34H49.948v14.934h8.905c6.884 0 10.68-2.772 10.68-7.727 0-4.643-3.264-7.207-9.012-7.207zM49.948 49.2v16.458H60.91c7.167 0 10.964-2.876 10.964-8.281 0-5.406-3.903-8.178-11.425-8.178H49.948z"
              fill="currentColor"></path>
          </svg>
          <span class="fs-4">Aplication Monolitic Flask Python</span>
        </a>
      </header>
    </div>

    <!-- As a link Container-->
    <div class="mt-3 mb-3">
      <!-- Tab Menu nav -->
      <ul class="nav nav-tabs" id="myTab" role="tablist">
        <li class="nav-item" role="presentation">
          <button class="nav-link active" id="home-tab" data-bs-toggle="tab" data-bs-target="#home" type="button"
            role="tab" aria-controls="home" aria-selected="true">Home</button>
        </li>
        <li class="nav-item" role="presentation">
          <button class="nav-link" id="profile-tab" data-bs-toggle="tab" data-bs-target="#profile" type="button"
            role="tab" aria-controls="profile" aria-selected="false">Estadisticas</button>
        </li>
      </ul>
    </div>

    <!-- Nav Bar Menu -->


    <main>

      <div class="tab-content" id="myTabContent">
        <div class="tab-pane fade show active" id="home" role="tabpanel" aria-labelledby="home-tab">


          <!-- Contenido To Inicio -->
          <div class="row">
            <h2>Bienvenidos a al cuestionario de uso de redes sociales!</h2>
          </div>

          <div class="row text-justify">
            <div class="col-5">
              <div class="card mt-3">
                <div class="card-header">
                  ¿Quieres saber mas sobre las redes sociales?
                </div>
                <div class="card-body">
                  <p class="text-justify">
                    Instagram, Facebook o Twitter son solo algunas de las plataformas de redes sociales más famosas que
                    existen en este siglo. Miles de millones de personas han estado usando las redes sociales
                    desde el momento de su aparición. ¿Alguna vez te has preguntado cómo empezó todo? ¿Quién fue el
                    fundador?
                    ¿Cómo ha evolucionado?
                  </p>

                  <p class="text-justify">
                    Al analizar la historia de las redes sociales, muchos consideran que "Six Degrees.com" fue la
                    primera
                    web de
                    redes sociales. Creada en Nueva York en 1997 (por el CEO Andrew Weinreich), incluía listas de amigos
                    y
                    familiares, así como afiliación escolar. Aunque probablemente no se consideró un "medio social" en
                    relación
                    a
                    las redes sociales actuales, sí dio los primeros pasos para la tecnología de comunicación digital
                    que
                    hicieron
                    posible posteriormente las redes sociales. Six Degrees estuvo activo hasta 2001 y se basó en el
                    modelo
                    de
                    red
                    social de la Web de Contactos.
                  </p>

                  <p class="text-justify">
                    Pero lo cierto es que tenemos que remontarnos un poco antes. Tom Truscott y Jim Ellis mencionaron
                    por
                    primera
                    vez la red Usenet en 1979. Usenet permitía publicar publicaciones de noticias o artículos en grupos
                    de
                    noticias. Los sistemas Usenet fueron los responsables de la evolución de los clientes lectores de
                    noticias.
                    Y
                    también son los precursores de los lectores de fuentes RSS.

                    Después llegarían los sistemas de tablón de anuncios (BBS), una de las primeras formas de las redes
                    sociales
                    a
                    fines de los años setenta. Solo eran accesibles por una persona a la vez, pero permitía a los
                    usuarios
                    iniciar
                    sesión y conectarse entre sí. Siguió siendo famoso hasta finales de la década de 1990.
                  </p>

                </div>
              </div>
            </div>


            <div class="col">
              <div class="card mt-3">
                <div class="card-header">
                  Test redes Sociales!
                </div>
                <div class="card-body">

                  <form id="formularioPrimary">
                    <div class="row">
                      <div class="col-12">
                        <div class="mb-3">
                          <label for="mailInput" class="form-label">Email address</label>
                          <input type="email" class="form-control" id="mailInput" aria-describedby="emailHelp" required>
                          <div id="emailHelp" class="form-text errorMessage">We'll never share your email with anyone
                            else.</div>
                        </div>
                      </div>
                      <div class="col-3">
                        <div class="mb-3">
                          <label for="years" class="form-label">Rango de edad</label>
                          <select class="form-select form-select-sm" aria-label="Small select example" id="years"
                            required>
                            <option selected>Open this select menu</option>
                            {%for i in data.years%}
                            <option value="{{i}}">{{i}}</option>
                            {%endfor%}
                          </select>
                        </div>
                      </div>
                      <div class="col-3">
                        <div class="mb-3">
                          <label for="sex" class="form-label">Sexo</label>
                          <select class="form-select form-select-sm" aria-label="Small select example" id="sex"
                            required>
                            <option selected>Open this select menu</option>
                            {%for i in data.sexos%}
                            <option value="{{i.id_sexo}}">{{i.name}}</option>
                            {%endfor%}
                          </select>
                        </div>
                      </div>
                      <div class="col-6">
                        <div class="mb-3">
                          <label for="favorite_red" class="form-label">Red social Favorita</label>
                          <select class="form-select form-select-sm" aria-label="Small select example" id="favorite_red"
                            required>
                            <option selected>Open this select menu</option>
                            {%for i in data.redes%}
                            <option value="{{i.id_red_social}}">{{i.name}}</option>
                            {%endfor%}
                          </select>
                        </div>
                      </div>

                      <div class="col-12 mt-3">
                        <div class="card ">
                          <div class="card-header">Indica el tiempo que usas cada red Social, en caso de no usarla
                            dejala
                            en blanco o indica no la uso!</div>
                          <div class="card-body">
                            <div class="row">
                              {%for i in data.redes%}
                              <!-- Redes Sociales -->
                              <div class="col-3">
                                <div class="mb-3">
                                  <label for="{{i.name}}" class="form-label">{{i.name}}</label>
                                  <select class="form-select form-select-sm" aria-label="Small select example"
                                    id="{{i.name}}">
                                    <option selected>Open this select menu</option>
                                    {%for red_hrs in data.horas_redes%}
                                    <option value={{red_hrs.id_horas_redes}}>{{red_hrs.descripcion}}</option>
                                    {%endfor%}
                                  </select>
                                </div>
                              </div>
                              {%endfor%}
                            </div>
                          </div>
                        </div>
                      </div>
                      <div class="col-12 mt-3 align-text-top text-center ">
                        <div>
                          <button type="submit" class="btn btn-outline-success">Enviar
                            Formulario!</button>
                        </div>
                      </div>
                    </div>
                  </form>
                </div>
              </div>
              <!-- Inicio del Formulario para la Encuesta! -->

              <!-- Inicio del Formulario para la Encuesta! -->
            </div>
          </div>
        </div>
        <div class="tab-pane fade" id="profile" role="tabpanel" aria-labelledby="profile-tab"> Ventana 2</div>
      </div>

    </main>
    <footer class="pt-2 my-3 text-muted border-top">
      Created by Develop Freddy Nava &middot; &copy; 2025
    </footer>
  </div>
  <script src="../assets/dist/js/bootstrap.bundle.min.js"></script>
</body>
<script>
  const errorMessage = document.getElementById('emailHelp');
  function validateEmail(email) {
    var regex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    return regex.test(email);
  }

  // Funcion para Verificar el correo si ya Existe
  URL_VAR = "http://127.0.0.1:5000/api"
  const mailInput = document.getElementById("mailInput");
  mailInput.addEventListener("input", verificarValor);


  // Verificar el valor Escrito en el Input
  function verificarValor(e) {
    const cadenaMail = e.target.value;

    // Varificar Correo
    if (validateEmail(cadenaMail)) {
      fetch(URL_VAR + "/verifyMail?mail=" + cadenaMail)
        .then(response => response.json().then(data => {
          if (response.status === 200) {
            errorMessage.textContent = data.message;
            errorMessage.style.color = "green";
          } else {
            errorMessage.textContent = data.message;
            errorMessage.style.color = "red";
          }
        }))
        .catch(error => {
          errorMessage.textContent = "Error al Verificar el Correo, Intente nuevamente!"
          errorMessage.style.color = "red";
        });

    } else {
      errorMessage.textContent = "El correo ingresado es Invalido!"
      errorMessage.style.color = "red";
    }
  }

  LimpiarFormulario();

  function mostrarToast(textoToast, status) {
    const backgroundColor = status === 200 ? "#28a745" : "#dc3545";
    const icono = status === 200 ? "✔️" : "❌"; // Icono de éxito o error
    Toastify({
      text: `${icono} ${textoToast}`,
      duration: 3000, // Duración en milisegundos
      gravity: "top", // Posición del toast (top o bottom)
      position: "right", // Posición dentro de la ventana (left, center o right)
      backgroundColor: backgroundColor, // Color de fondo
      stopOnFocus: true, // Detiene la temporización del toast si se pasa el ratón por encima
    }).showToast();
  }


  // Captar Submit para mejorar Validacion
  document.getElementById('formularioPrimary').addEventListener('submit', function (event) {
    event.preventDefault();
    return registrarFormulario()
  });

  // Al cargar la pagina Reiniciar Formulario
  function LimpiarFormulario() {
    document.addEventListener('DOMContentLoaded', function () {
      document.getElementById('formularioPrimary').reset(); // Limpiar formulario al cargar la página
    });
  }
  // ---------------------------------------------------
  // Obtener datos del Formulario y Enviar
  // ---------------------------------------------------
  function registrarFormulario() {
    var arrayRedes = [];
    {% for red in data.redes %}
    arrayRedes.push({
      id_red: "{{ red.id_red_social }}",
      value: document.getElementById("{{ red.name }}").value,
    });
    {% endfor %}

    // Obtener Primera parte del Input Valores
    let valoresRequerdiso = {
      mail: document.getElementById("mailInput").value,
      years: document.getElementById("years").value,
      favorite_network: document.getElementById("favorite_red").value,
      sex: document.getElementById("sex").value,
      redes_sociales: arrayRedes
    };

    // --------------------------------------------------------
    // Enviar Valores al Endpoint Registrar Encuesta!
    // --------------------------------------------------------
    fetch(URL_VAR + '/RegisterSurvey', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json'
      },
      body: JSON.stringify(valoresRequerdiso)
    })
      .then(response => {
        if (response.status !== 200) {
          // Si es Diferente a 200 retorno esto en la respuesta!
          return response.json().then(errorData => {
            throw new Error(`ErrorCodeDiferent ${response.status}: ${errorData.message}`);
          });
        }
        return response.json();
      })
      .then(data => {
        mostrarToast(data.message, 200);
        document.getElementById('formularioPrimary').reset();
        errorMessage.textContent = "We'll never share your email with anyone else."
      })
      .catch(error => {
        if (error.message.startsWith("ErrorCodeDiferent")) {
          const status = parseInt(error.message.split(' ')[1]);
          const message = error.message.split(': ')[1];
          mostrarToast(message, status);
        } else {
          mostrarToast("No se pudo completar la solicitud, ¡Intente nuevamente más tarde!", 500);
        }
      });
  }


</script>
<script src="https://cdn.jsdelivr.net/npm/toastify-js"></script>

</html>